---
- name: Ensure compose directory exists for {{ svc.key }}
  when: svc.value.compose is defined
  ansible.builtin.file:
    path: "{{ svc.value.compose.project_dir }}"
    state: directory
    owner: "{{ svc.value.compose.owner | default(service_directory_owner | default('root')) }}"
    group: "{{ svc.value.compose.group | default(service_directory_group | default('root')) }}"
    mode: "{{ svc.value.compose.directory_mode | default(service_directory_mode | default('0750')) }}"

- name: Ensure appdata entries exist for {{ svc.key }}
  when: (svc.value.appdata | default([])) | length > 0
  ansible.builtin.file:
    path: "{{ app_entry.dest }}"
    state: directory
    owner: "{{ app_entry.owner | default(service_directory_owner | default('root')) }}"
    group: "{{ app_entry.group | default(service_directory_group | default('root')) }}"
    mode: "{{ app_entry.directory_mode | default(service_directory_mode | default('0750')) }}"
  loop: "{{ svc.value.appdata | default([]) }}"
  loop_control:
    loop_var: app_entry
    label: "{{ app_entry.dest }}"

- name: Ensure extra directories exist for {{ svc.key }}
  when: (svc.value.extra_directories | default([])) | length > 0
  ansible.builtin.file:
    path: "{{ extra_dir.path }}"
    state: directory
    owner: "{{ extra_dir.owner | default(service_directory_owner | default('root')) }}"
    group: "{{ extra_dir.group | default(service_directory_group | default('root')) }}"
    mode: "{{ extra_dir.mode | default(service_directory_mode | default('0750')) }}"
  loop: "{{ svc.value.extra_directories | default([]) }}"
  loop_control:
    loop_var: extra_dir
    label: "{{ extra_dir.path }}"
