---
- name: Ensure required secrets are populated
  ansible.builtin.assert:
    that:
      - (item.value | default('')) | length > 0
    fail_msg: "{{ item.fail_msg }}"
  loop:
    - name: domain
      value: "{{ domain }}"
      fail_msg: "DOMAIN must be set and non-empty"
    - name: base_dn
      value: "{{ base_dn }}"
      fail_msg: "BASE_DN must be set and non-empty"
    - name: domain_demos
      value: "{{ domain_demos }}"
      fail_msg: "DOMAIN_DEMOS must be set and non-empty"
    - name: acme_cert_email
      value: "{{ acme_cert_email }}"
      fail_msg: "ACME_CERT_EMAIL must be set and non-empty"
    - name: acme_letsencrypt_url
      value: "{{ acme_letsencrypt_url }}"
      fail_msg: "ACME_LETSENCRYPT_URL must be set and non-empty"
    - name: smtp_host
      value: "{{ smtp_host }}"
      fail_msg: "SMTP_HOST must be set and non-empty"
    - name: smtp_port
      value: "{{ smtp_port }}"
      fail_msg: "SMTP_PORT must be set and non-empty"
    - name: smtp_user
      value: "{{ smtp_user }}"
      fail_msg: "SMTP_USER must be set and non-empty"
    - name: smtp_sender
      value: "{{ smtp_sender }}"
      fail_msg: "SMTP_SENDER must be set and non-empty"
    - name: authelia_lldap_password
      value: "{{ authelia_lldap_password }}"
      fail_msg: "AUTHELIA_LLDAP_PASSWORD must be set and non-empty"
    - name: ollama_oauth_client_secret
      value: "{{ ollama_oauth_client_secret }}"
      fail_msg: "OLLAMA_OAUTH_CLIENT_SECRET must be set and non-empty"
    - name: authelia_private_key
      value: "{{ authelia_private_key }}"
      fail_msg: "AUTHELIA_PRIVATE_KEY must be set and non-empty (ensure stacks/janus/auth/config/keys/private.pem exists)"
    - name: forgejo_oauth_client_secret
      value: "{{ forgejo_oauth_client_secret }}"
      fail_msg: "FORGEJO_OAUTH_CLIENT_SECRET must be set and non-empty"
    - name: immich_oauth_client_secret
      value: "{{ immich_oauth_client_secret }}"
      fail_msg: "IMMICH_OAUTH_CLIENT_SECRET must be set and non-empty"
  loop_control:
    label: "{{ item.name }}"
