---
- name: Ensure required secrets are populated
  ansible.builtin.assert:
    that:
      - (item.value | default('')) | length > 0
    fail_msg: "{{ item.fail_msg }}"
  loop:
    - name: domain
      value: "{{ domain }}"
      fail_msg: "DOMAIN must be set and non-empty"
    - name: acme_cert_email
      value: "{{ acme_cert_email }}"
      fail_msg: "ACME_CERT_EMAIL must be set and non-empty"
    - name: acme_letsencrypt_url
      value: "{{ acme_letsencrypt_url }}"
      fail_msg: "ACME_LETSENCRYPT_URL must be set and non-empty"
  loop_control:
    label: "{{ item.name }}"
